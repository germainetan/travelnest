<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancel Booking</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>



  <link rel="stylesheet" href="../css/style.css">
  <style>

    body {
      background-image: url("../images/background.jpeg");
    }
    .card-title, .card-subtitle {
      color: #C5C9A4;
    }
    .form-label {
      font-size: small;
      font-weight: bold;
      color: #C5C9A4;
    }
    .btn {
      color: white;
      padding-left: 30px;
      padding-right: 30px;
    }
    .box {
      padding: 0 20px 0 60px;
    }
    a:link {
      background-color: transparent;
      text-decoration: none;
    }
    a:visited {
      background-color: transparent;
      text-decoration: none;
    }
    a:active {
      color:#476A6F;
      background-color: transparent;
      text-decoration: underline;
    }
    .propertyimg {
      width:100%; 
      height:100%;
    }
    .navbar-brand img {
      height: 50px;
      width: 50px;
    }
    .form-select{
        margin-left: 750px;
        width: 30%;
    }
    .wrapper{
        display: flex;
        margin: 0 100 100 0;
    }
    h3{
        margin: 30 10 10 50;
    }
  </style>


</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
      <a class="navbar-brand" href="#">
          <img src="../images/logo.png">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
          <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="index.html">Home</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:black">
              Check Bookings
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="rentercheckbookinglogin.html" style="color:black">I am a Renter</a></li>
              <li><a class="dropdown-item" href="ownercheckbookinglogin.html" style="color:black">I am an Owner</a></li>
            </ul>
          </li>
          </ul>
      </div>
      </div>
    </nav>

    <div id="root">
        <div class="container-fluid p-3">
            <div class="row">
                <div class="col">
                <div class="card rounded-4">
                    <div class="card-body">

                        <div class="wrapper">
                            <h3>Booking Details</h3>
                                
                            <select class="form-select" aria-label="Default select example" v-model="booking_status">
                                <option value="pending" selected>Pending</option>
                                <option value="confirmed">Confirmed</option>
                            </select>
                        </div> <br>
    
                      <span v-if="bookings">
                          <table class="table" :class="{ 'loading': isFetching, 'visible': !isFetching }">
                            <thead>
                              <tr>
                                <th scope="col">Booking ID</th>
                                <th scope="col">Property</th>
                                <th scope="col">Booking Status</th>
                                <th scope="col">Period of Stay</th>
                                <th scope="col">Actions</th>
                              </tr>
                            </thead>
                            <tbody>
                                <tr v-for="booking in bookings">
                                    <td>{{booking.bookingID}}</td>
                                    <td>{{booking.property.title}} <br> <span style="color: grey;">{{booking.property.city}}, {{booking.property.country}} <br> {{booking.property.address}}</span></td>
                                    <td>{{booking_status}}</td>
                                    <td>{{booking.start_datetime}}<br> to {{booking.end_datetime}}</td>
                                    <td><button type="button" class="btn btn-warning">Cancel Booking</button></td>
                                </tr>
                            </tbody>
                          </table>
                      </span>
                      <span v-else>{{alertMsg}}</span>
                    </div>
                  </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        Vue.createApp({
            data(){
                return{
                    isPending: true,
                    booking_status: 'confirmed',
                    confirmedObj: null,
                    pendingObj: null,
                    bookings: null,
                    personID:2,
                    alertMsg: null,
                    isFetching: false
                }
            },
            methods:{
                fetchBookingData(){
                    this.isFetching = true;
                    const url = 'http://localhost:8000/check_booking'
                    const data = { personID: this.personID,
                                    booking_status: this.booking_status,
                                    status: "renter"
                                }
                    // POST request
                    axios.post(url, data
                    )
                    .then(response => {
                        this.bookings = response.data.data.check_book_results
                        console.log(this.bookings)
                        this.isFetching = false;
                        
                    })
                    .catch(error => {
                        this.status = 'There was an error: ' + error.message 
                        this.bookings=null
                        this.alertMsg = 'There are no current bookings.'
                        console.log(this.bookings)
                        this.isFetching = false;
                    })  
                    
                },
                beforeUpdate() {
                    // Add a class to the table before the data is updated
                    $('table.loading').addClass('invisible');
                },
                updated() {
                    // Remove the class from the table after the data is updated
                    $('table.invisible').removeClass('invisible').addClass('visible');
                },
            },
            created(){
                this.fetchBookingData()
            },
            watch: {
                booking_status(){
                    this.fetchBookingData();
                }
            }

        }).mount('#root')
      
    </script>
    
</body>
</html>

